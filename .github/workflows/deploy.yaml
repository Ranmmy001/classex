name: Deplyment

on:
  push:
    branches:
    - master

  
jobs:
    job1:

      runs-on: ubuntu-latest
      steps:
      - name: "checkout"
        uses: actions/checkout@v4


      - name: "Build the Docker image"
        run: |
          docker build -t olaranmmy/testimage100 .

      - name: "push to Dockerhub"
        run:   |
            docker login -u olaranmmy -p "${{secrets.DOCKER_PASSWORD}}"
            docker push olaranmmy/testimage100
            echo "image pushed successfully!"


    job2:
        runs-on: ubuntu-latest
        needs: job1
        steps:
        - name: "confirm the job"
          run: |
           echo "This is the second job"
            
        - name: "checkout"
          uses: actions/checkout@v4

        - name: "Uploads as an artifact"
          uses: actions/upload-artifact@v4
          with:
            name: "sample-artifact"
            path: "index.html"
            retention-days: 60

        - name: "Uploads as a second artifact"
          uses: actions/upload-artifact@v4
          with:
            name: "sample-artifact2"
            path: "index.html"
            retention-days: 60   
    
    job3:
        runs-on: ubuntu-latest
        needs: job2
        steps:
        - name: "confirm the job3"
          run: |
           echo "This is the third job"
            
        - name: "checkout"
          uses: actions/checkout@v4

        - name: Login to Dockerhub
          run: docker login -u olaranmmy -p "${{ secrets.DOCKER_PASSWORD }}"

        - name: Pull image from Dockerhub
          run: docker pull olaranmmy/testimage100

        - name: Save Docker image as artifact
          run: docker save olaranmmy/testimage100 -o image.tar

        - name: upload Docker image artifact
          uses: actions/upload-artifact@v4
          with:
            name: docker-image 
            path: image.tar


    job4:
        runs-on: ubuntu-latest
        needs: job3
        steps:
        - name: "confirm the job4"
          run: |
           echo "This is the fourth job"
            
        - name: "checkout"
          uses: actions/checkout@v4

        - name: Login to Docker Hub
          run: docker login -u olaranmmy -p "${{ secrets.DOCKER_PASSWORD }}"


        - name: Download  Docker image artifact
          uses: actions/download-artifact@v4
          with:
            name: docker-image

        - name: Load Docker image
          run: docker load -i image.tar

        - name: Run container
          run: docker run -d -p 8080:80 olaranmmy/testimage100


       # - name: "pull the image from dockerhub into the environment"
        #  run: |
         #   docker pull olaranmmy/testimage100
          #  echo "Image pulled successfully"
           # docker run -d -p 8080:80 olaranmmy/testimage100



